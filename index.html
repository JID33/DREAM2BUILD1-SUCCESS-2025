<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dream2Build1 - Authentication</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f1f1f1; }
        h1, h2 { text-align: center; color: #007BFF; }
        .container, .panel, .form-section {
            max-width: 900px; margin: auto; background: white; padding: 20px;
            border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input, select, textarea {
            width: 100%; padding: 10px; margin-top: 5px; margin-bottom: 15px;
            border: 1px solid #ccc; border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #28a745; color: white; border: none; padding: 10px 20px;
            font-size: 16px; border-radius: 5px; cursor: pointer;
        }
        button:hover { background-color: #218838; }
        .hidden { display: none; }
        .logout-btn button { background-color: #dc3545; }
        .error-msg { color: red; font-weight: bold; }
        .success-msg { color: green; font-weight: bold; }

        /* Specific styles for the main platform content */
        #mainPlatform {
            border: 1px dashed #007BFF;
            padding: 30px;
            text-align: center;
            font-size: 1.2em;
            color: #007BFF;
        }
    </style>
</head>
<body>

<h1>Dream2Build1 - Authentication System</h1>

<div class="form-section" id="signUpPanel">
    <h2>üìù Sign Up for Access</h2>
    <form id="signUpForm">
        <label for="fullName">Full Name:</label>
        <input type="text" id="fullName" name="fullName" placeholder="Enter your full name" required>

        <label for="phoneNumber">Phone Number:</label>
        <input type="tel" id="phoneNumber" name="phoneNumber" placeholder="e.g., +150912345678" required>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" placeholder="Enter your email" required>

        <label for="password">Password:</label>
        <input type="password" id="password" name="password" placeholder="Create your password" required>

        <label for="confirmPassword">Confirm Password:</label>
        <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Re-enter your password" required>

        <button type="submit">Sign Up</button>
        <p id="signUpMsg" class="hidden"></p>
    </form>
    <p style="text-align: center; margin-top: 15px;">Already have an account? <a href="#" onclick="showLogin()">Login here</a></p>
</div>

<div class="form-section hidden" id="loginPanel">
    <h2>üîê Log In to Your Account</h2>
    <form id="loginForm">
        <label for="loginEmail">Email:</label>
        <input type="email" id="loginEmail" name="loginEmail" placeholder="Enter your email" required>

        <label for="loginPassword">Password:</label>
        <input type="password" id="loginPassword" name="loginPassword" placeholder="Enter your password" required>

        <button type="submit">Log In</button>
        <p id="loginMsg" class="hidden"></p>
    </form>
    <p style="text-align: center; margin-top: 15px;">Don't have an account? <a href="#" onclick="showSignUp()">Sign Up here</a></p>
</div>

<div class="panel hidden" id="verificationMessagePanel">
    <h2>üìß Verify Your Email</h2>
    <p>A verification email has been sent to <strong id="verificationEmailDisplay"></strong>. Please check your inbox and click the verification link to activate your account.</p>
    <p>After verification, you will be redirected to the login page.</p>
    <button onclick="showLogin()">Go to Login (After Verification)</button>
</div>

<div class="panel hidden" id="mainPlatformPanel">
    <h2>Bienvenue sur Dream2Build1, <span id="loggedInUserName"></span>!</h2>
    <div id="mainPlatform">
        <p>This is your main platform content, accessible only after successful login.</p>
        <p>Here you can explore all features, except the administration area.</p>
        <p>üöÄ Ready to build your dreams!</p>
    </div>
    <div class="logout-btn">
        <button onclick="logoutUser()">Log Out</button>
    </div>
</div>

<div class="form-section hidden" id="leaderRegisterPanel">
    <h2>üë• Team Leader Registration (Admin Only)</h2>
    <label for="leaderName">Full Name:</label>
    <input type="text" id="leaderName" placeholder="Enter full name">

    <label for="leaderEmailReg">Email:</label>
    <input type="email" id="leaderEmailReg" placeholder="Enter email">

    <label for="leaderPass1">Create Password:</label>
    <input type="password" id="leaderPass1" placeholder="Create password">

    <label for="leaderPass2">Confirm Password:</label>
    <input type="password" id="leaderPass2" placeholder="Confirm password">

    <button onclick="registerLeader()">Register as Team Leader</button>
    <p id="leaderRegisterMsg"></p>
</div>

<div class="form-section hidden" id="leaderLoginPanel">
    <h2>üîê Team Leader Login (Admin Only)</h2>
    <label for="loginLeaderEmail">Email:</label>
    <input type="email" id="loginLeaderEmail" placeholder="Enter email">

    <label for="loginLeaderPass">Password:</label>
    <input type="password" id="loginLeaderPass" placeholder="Enter password">

    <button onclick="loginLeader()">Login</button>
    <p id="leaderLoginMsg"></p>
</div>

<div id="leaderPanel" class="panel hidden">
    <h2>üßë‚Äçü§ù‚Äçüßë Team Leader Dashboard</h2>
    <p>Welcome, <span id="leaderNameDisplay"></span>!</p>
    <button class="logout-btn" onclick="logoutLeader()">Logout</button>
    <p>Here you can submit validated new members after their payment.</p>
    </div>

<div id="ceoPanel" class="panel hidden">
    <h2>üëë CEO Dashboard</h2>
    <p>Welcome, CEO!</p>
    <button onclick="calculRotation()">Show Today's Rotation</button>
    <button onclick="nextRotation()">‚û°Ô∏è Next Day</button>
    <div id="rotationResult" class="rotation-box hidden"></div>

    <h3>üìã 25-day History:</h3>
    <table id="historyTable">
        <thead>
            <tr>
                <th>Day</th>
                <th>Member</th>
                <th>Total ($)</th>
                <th>Reserve</th>
                <th>Withheld (10%)</th>
                <th>To Receive</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>Emmanuel Jean</td>
                <td>100.00</td>
                <td>33.33</td>
                <td>3.33</td>
                <td>66.67</td>
            </tr>
            </tbody>
    </table>
    <div class="logout-btn">
        <button onclick="logoutCEO()">Logout CEO</button>
    </div>
</div>

<script>
    // --- Helper Functions to Toggle Panels ---
    function hideAllPanels() {
        document.getElementById('signUpPanel').classList.add('hidden');
        document.getElementById('loginPanel').classList.add('hidden');
        document.getElementById('verificationMessagePanel').classList.add('hidden');
        document.getElementById('mainPlatformPanel').classList.add('hidden');
        document.getElementById('leaderRegisterPanel').classList.add('hidden'); // Admin
        document.getElementById('leaderLoginPanel').classList.add('hidden');   // Admin
        document.getElementById('leaderPanel').classList.add('hidden');      // Admin
        document.getElementById('ceoPanel').classList.add('hidden');         // Admin
    }

    function showSignUp() {
        hideAllPanels();
        document.getElementById('signUpPanel').classList.remove('hidden');
    }

    function showLogin() {
        hideAllPanels();
        document.getElementById('loginPanel').classList.remove('hidden');
    }

    function showMainPlatform(userName) {
        hideAllPanels();
        document.getElementById('mainPlatformPanel').classList.remove('hidden');
        document.getElementById('loggedInUserName').textContent = userName;
    }

    function showVerificationMessage(email) {
        hideAllPanels();
        document.getElementById('verificationMessagePanel').classList.remove('hidden');
        document.getElementById('verificationEmailDisplay').textContent = email;
    }

    // --- User Authentication (Sign Up & Login) ---

    // Simulate user storage (for demo purposes)
    const users = JSON.parse(localStorage.getItem('users')) || {};
    const admins = JSON.parse(localStorage.getItem('admins')) || {}; // For leaders/CEO

    document.getElementById('signUpForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent default form submission

        const fullName = document.getElementById('fullName').value.trim();
        const phoneNumber = document.getElementById('phoneNumber').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const msg = document.getElementById('signUpMsg');

        msg.classList.add('hidden'); // Hide previous messages

        if (!fullName || !phoneNumber || !email || !password || !confirmPassword) {
            msg.textContent = '‚ùå Please fill in all fields.';
            msg.classList.remove('hidden', 'success-msg');
            msg.classList.add('error-msg');
            return;
        }

        if (password !== confirmPassword) {
            msg.textContent = '‚ùå Passwords do not match.';
            msg.classList.remove('hidden', 'success-msg');
            msg.classList.add('error-msg');
            return;
        }

        if (users[email]) {
            msg.textContent = '‚ùå This email is already registered.';
            msg.classList.remove('hidden', 'success-msg');
            msg.classList.add('error-msg');
            return;
        }

        // Simulate email verification by marking user as 'unverified'
        users[email] = {
            fullName: fullName,
            phoneNumber: phoneNumber,
            password: password, // In a real app, hash this password!
            verified: false // Set to false initially
        };
        localStorage.setItem('users', JSON.stringify(users));

        msg.textContent = '‚úÖ Sign up successful! Please check your email for verification.';
        msg.classList.remove('hidden', 'error-msg');
        msg.classList.add('success-msg');

        // Simulate sending verification email and then redirecting to login after "verification"
        // In a real app, this would be a backend call to send an email with a unique link.
        setTimeout(() => {
            // Simulate email verification happening
            users[email].verified = true;
            localStorage.setItem('users', JSON.stringify(users));
            showVerificationMessage(email);
        }, 1000); // Small delay to show success message before "redirecting"
    });

    document.getElementById('loginForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent default form submission

        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value;
        const msg = document.getElementById('loginMsg');

        msg.classList.add('hidden'); // Hide previous messages

        const user = users[email];

        if (!user) {
            msg.textContent = '‚ùå No account found with this email.';
            msg.classList.remove('hidden', 'success-msg');
            msg.classList.add('error-msg');
            return;
        }

        if (!user.verified) {
            msg.textContent = '‚ùå Please verify your email first. Check your inbox!';
            msg.classList.remove('hidden', 'success-msg');
            msg.classList.add('error-msg');
            return;
        }

        if (user.password !== password) { // In a real app: compare hashed passwords!
            msg.textContent = '‚ùå Incorrect password.';
            msg.classList.remove('hidden', 'success-msg');
            msg.classList.add('error-msg');
            return;
        }

        // Successful Login for general user
        localStorage.setItem('currentUser', JSON.stringify({ email: user.email, name: user.fullName, role: 'user' }));
        showMainPlatform(user.fullName);
    });

    function logoutUser() {
        localStorage.removeItem('currentUser');
        showLogin(); // Go back to login page
    }

    // --- Admin (Team Leader / CEO) Logic (kept from your original, slightly adapted) ---
    // Note: This logic assumes admin roles are separate from regular users
    // For a real system, you might integrate roles within a single user management system.

    function registerLeader() {
        const name = document.getElementById('leaderName').value.trim();
        const email = document.getElementById('leaderEmailReg').value.trim();
        const pass1 = document.getElementById('leaderPass1').value;
        const pass2 = document.getElementById('leaderPass2').value;
        const msg = document.getElementById('leaderRegisterMsg');

        if(!name || !email || !pass1 || !pass2) {
            msg.textContent = '‚ùå Please fill all fields';
            msg.className = 'error-msg';
            return;
        }
        if(pass1 !== pass2) {
            msg.textContent = '‚ùå Passwords do not match';
            msg.className = 'error-msg';
            return;
        }
        if (admins[email]) {
            msg.textContent = '‚ùå This email is already registered as an admin.';
            msg.className = 'error-msg';
            return;
        }

        admins[email] = { name, email, password: pass1, role: 'leader' };
        localStorage.setItem('admins', JSON.stringify(admins));

        msg.textContent = '‚úÖ Registration successful. You can now login as a Leader.';
        msg.className = 'success-msg';

        document.getElementById('leaderName').value = '';
        document.getElementById('leaderEmailReg').value = '';
        document.getElementById('leaderPass1').value = '';
        document.getElementById('leaderPass2').value = '';
    }

    function loginLeader() {
        const email = document.getElementById('loginLeaderEmail').value.trim();
        const pass = document.getElementById('loginLeaderPass').value;
        const msg = document.getElementById('leaderLoginMsg'); // Changed ID for clarity
        const stored = admins[email];

        if(!stored) {
            msg.textContent = '‚ùå No leader account found with this email.';
            msg.className = 'error-msg';
            return;
        }

        if(stored.password !== pass) {
            msg.textContent = '‚ùå Incorrect password.';
            msg.className = 'error-msg';
            return;
        }

        localStorage.setItem('currentAdmin', JSON.stringify({ email: stored.email, name: stored.name, role: stored.role }));
        hideAllPanels();
        document.getElementById('leaderPanel').classList.remove('hidden');
        document.getElementById('leaderNameDisplay').textContent = stored.name;
    }

    function logoutLeader() {
        localStorage.removeItem('currentAdmin');
        showLogin(); // Redirect to main login page
    }

    // CEO Specific (assuming a fixed CEO account or separate login)
    function showCEOPanel() {
        // For demo, let's say CEO email is 'ceo@dream2build.com' and password is 'admin123'
        const ceoEmail = 'ceo@dream2build.com';
        const ceoPassword = 'admin123'; // NEVER hardcode passwords in real apps!

        const email = prompt("Enter CEO Email:");
        const password = prompt("Enter CEO Password:");

        if (email === ceoEmail && password === ceoPassword) {
            localStorage.setItem('currentAdmin', JSON.stringify({ email: ceoEmail, name: 'CEO', role: 'ceo' }));
            hideAllPanels();
            document.getElementById('ceoPanel').classList.remove('hidden');
        } else {
            alert("Invalid CEO credentials.");
        }
    }

    function logoutCEO() {
        localStorage.removeItem('currentAdmin');
        showLogin(); // Redirect to main login page
    }

    // Rotation calculation placeholder (from your original)
    function calculRotation() {
        const resultDiv = document.getElementById('rotationResult');
        resultDiv.textContent = 'Rotation calculation will be implemented here.';
        resultDiv.classList.remove('hidden');
    }

    function nextRotation() {
        alert('Next rotation day functionality coming soon!');
    }

    // --- Initial Load Logic ---
    window.onload = function() {
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin'));

        if (currentUser && currentUser.role === 'user') {
            showMainPlatform(currentUser.name);
        } else if (currentAdmin) {
            if (currentAdmin.role === 'leader') {
                hideAllPanels();
                document.getElementById('leaderPanel').classList.remove('hidden');
                document.getElementById('leaderNameDisplay').textContent = currentAdmin.name;
            } else if (currentAdmin.role === 'ceo') {
                hideAllPanels();
                document.getElementById('ceoPanel').classList.remove('hidden');
            }
        } else {
            showSignUp(); // Default to sign-up page
        }

        // For demo, you can add a way to access admin login directly
        // For example, an invisible link or a special key combination for testing.
        // For now, let's add a button to reveal admin login/register.
        const adminAccessButton = document.createElement('button');
        adminAccessButton.textContent = 'Admin / Leader Access';
        adminAccessButton.style.marginTop = '20px';
        adminAccessButton.style.display = 'block';
        adminAccessButton.style.marginLeft = 'auto';
        adminAccessButton.style.marginRight = 'auto';
        adminAccessButton.onclick = function() {
            hideAllPanels();
            document.getElementById('leaderLoginPanel').classList.remove('hidden');
            document.getElementById('leaderRegisterPanel').classList.remove('hidden');
             // Add a CEO login button here too for convenience
            const ceoLoginBtn = document.createElement('button');
            ceoLoginBtn.textContent = 'Login as CEO';
            ceoLoginBtn.style.marginTop = '10px';
            ceoLoginBtn.style.backgroundColor = '#6c757d'; // Gray color
            ceoLoginBtn.onclick = showCEOPanel;
            if (!document.getElementById('leaderLoginPanel').querySelector('#ceoLoginBtn')) {
                document.getElementById('leaderLoginPanel').appendChild(ceoLoginBtn);
                ceoLoginBtn.id = 'ceoLoginBtn'; // Assign an ID to prevent duplicates
            }
        };
        document.body.appendChild(adminAccessButton);
    };
</script>

</body>
</html>
